<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link rel="stylesheet" href="index.css">
  <title>NoNego ðŸ’¸ðŸ’» - My Cart</title>
</head>
<body>

<!-- 

  =====[Point System]=====
  Delta - 0 to 299
  Omega - 300 to 899
  Alpha - 900 and above

  Every Item Purchased = 2 tokens
  Each token = Play Game
  Play Game = Earn Points
  Points = Get Vouchers



-->

  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand fs-2 text-white" href="#">NoNego!</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto fs-4">
                    <li class="nav-item">
                        <a href="#" class="nav-link active text-white" aria-current="page">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="home.html" class="nav-link text-white">Shop</a>
                    </li>
                    <li class="nav-item">
                        <a href="personalization.html" class="nav-link text-white">My Account</a>
                    </li>
                    <li class="nav-item">
                        <a href="myCart.html" class="nav-link text-white myCart">My Cart</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="shoppingCart">

      <div class='container'>

        <div class="row" style="justify-content: center">
            <div class="card mt-100">
                <div class="card-content">
                    <div class="card-body p-0">
                        <div class="profile"> <img src="media/shoppingCart.png"> </div>
                        <div class="card-subtitle  cartAppend">
                        </div>
                        <div class="row">
                          <div class="col d-flex justify-content-end m-5">
                            <h1>Total: $<span class="cartTotal"></span></h1>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col d-flex justify-content-end">
                            <button type="button" class="btn btn-primary me-5 purchase">Purchase</button>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

      </div>

    </section>


    <section id="rewards">

      <div class='container2'>

        <div class="row" style="justify-content: center;">
            <div class="card mt-100">

                <div class="card-content">

                    <div class="card-body p-0">
                        <div class="profile"> 
                          <img src="media/rewards.png">
                        </div>
                        <div class="card-subtitle">

                          <div class="vouchers">
                            <h3 style="margin-right: 60%;">Vouchers Available: </h3>
                            
                            <div id="vchrTypes">
<!--
                              <div class="vchr row" style="justify-content: center;">

                                <div class="col-sm-6">
                                  <div class="card">
                                    <div class="card-body" style="margin-top: 75px;">
                                      <h5 class="card-title">Special title treatment</h5>
                                      <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                                      <a href="#" class="btn btn-primary">Apply Voucher</a>
                                    </div>
                                  </div>
                                </div> 

                              </div> -->

                            </div>

                          </div>

                          <div class="rewards mt-5">
                            <h3 style="text-align: left;">Membership: <br>
                              <div id="userMembership" style="text-align: left;"></div>
                            </h3>
                            <h3 style="text-align: left;" style="margin-right: 69%;">Points: <br>
                            <div style="text-align: left;" id="userPoints"></div>
                            </h3>

                            <h3 style="text-align: left;" style="margin-right: 69%;">Game Tokens: <br>
                              <div style="text-align: left;" id="gameTokens"></div>
                            </h3>
                            
                            <div class="progress">
                              <div class="progress-done" data-done="100">
                                100%
                              </div>
                            </div>

                            <div id="gamesProfiles" class="profile">
                              <button onclick="startBallGame()">
                                <img src="media/basketball.png">
                              </button>
                              <button onclick="inProgress()">
                                <img src="media/dinosaur.png" alt="">
                              </button>
                              <button onclick="inProgress()">
                                <img src="media/flappyBird.png">
                              </button>
                            </div>

                            <button id="gsBtn" onclick="displayGames()">Start Game</button>
                            <div id="egBtnPlace"></div>

                            <div id="gameLocation" style="justify-content: center;">
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>

      </div>

    </section>

  </header>
  <script src="https://unpkg.com/ionicons@5.4.0/dist/ionicons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="phaser.min.js"></script>
<script type="text/javascript">

  const progress = document.querySelector('.progress-done');
  progress.innerHTML = localStorage.getItem("userPoints");

  var points = parseInt(localStorage.getItem("userPoints")) / 900 * 100
  progress.style.width = points + '%';
  progress.style.opacity = 1;


  document.getElementById('userMembership').innerHTML = `${localStorage.getItem("userMembership")}`;
  document.getElementById('userPoints').innerHTML = `${localStorage.getItem("userPoints")}`;
  document.getElementById('gameTokens').innerHTML = `${localStorage.getItem("userTokens")}`;

  function inProgress() 
  {
    alert("STILL WORKING ON IT");
  }

  function displayGames()
  {
    if (localStorage.getItem("userTokens") <= 0)
    {
      alert("You do not have any tokens! Please purchase items to obtain tokens!");
    }
    else 
    {
      $("#gamesProfiles").show();
      $("#gsBtn").hide();
    }
  }

  function endGame()
  {

    console.log("Ending Game");
    $("#gamesProfiles").hide();
    $("span").remove();
    $("canvas").remove();

    var userID = localStorage.getItem("userID");
    console.log(userID);
    var hScore = sessionStorage.getItem("basketballhighScore");
    afterGame(userID, hScore * 10);

  }

  function afterGame(userID, newPoints)
{

    var prevPoints = localStorage.getItem("userPoints");
    var memberResult = checkMembership(parseInt(prevPoints) + parseInt(newPoints))

    var jsondata = {

        "friendsList": localStorage.getItem("friendsList"),
        "userAvatar": localStorage.getItem("userAvatar"),
        "userMembership": memberResult,
        "userPoints": parseInt(prevPoints) + parseInt(newPoints),
        "useremail": localStorage.getItem("userName"),
        "userpass": localStorage.getItem("userPass"),
        "userTokens": parseInt(localStorage.getItem("userTokens")) - 1,
      
    };
    var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment/" + userID,
    "method": "PUT",
    "headers": {
        "content-type": "application/json",
        "x-apikey": "5ffd5eb61346a1524ff12901",
        "cache-control": "no-cache"
    },
    "processData": false,
    "data": JSON.stringify(jsondata)
    }

    $.ajax(settings).done(function (response) {
    console.log(response);
    
    localStorage.setItem("userTokens", localStorage.getItem("userTokens") - 1);
    localStorage.setItem("userPoints", prevPoints + newPoints);
    sessionStorage.clear();

    refreshData();
    });

}


  // NOTE: Originally 640x1000. Other possible sizes: 512x800, 400x625
  function startBallGame()
  {
    var game = new Phaser.Game(400, 625, Phaser.CANVAS, '', { preload: preload, create: create, update: update });

      function preload() {
  
      game.load.image('ball', 'assets/images/ball.png');
      game.load.image('hoop', 'assets/images/hoop.png');
      game.load.image('side rim', 'assets/images/side_rim.png');
      game.load.image('front rim', 'assets/images/front_rim.png');
  
      game.load.image('win0', 'assets/images/win0.png');
      game.load.image('win1', 'assets/images/win1.png');
      game.load.image('win2', 'assets/images/win2.png');
      game.load.image('win3', 'assets/images/win3.png');
      game.load.image('win4', 'assets/images/win4.png');
      game.load.image('lose0', 'assets/images/lose0.png');
      game.load.image('lose1', 'assets/images/lose1.png');
      game.load.image('lose2', 'assets/images/lose2.png');
      game.load.image('lose3', 'assets/images/lose3.png');
      game.load.image('lose4', 'assets/images/lose4.png');
  
      game.load.audio('score', 'assets/audio/score.wav');
      game.load.audio('backboard', 'assets/audio/backboard.wav');
      game.load.audio('whoosh', 'assets/audio/whoosh.wav');
      game.load.audio('fail', 'assets/audio/fail.wav');
      game.load.audio('spawn', 'assets/audio/spawn.wav');
  
  }
  
  var hoop,
       left_rim,
       right_rim,
       ball,
       front_rim,
       current_score = 0,
       current_score_text,
       high_score = 0,
       high_score_text,
       current_best_text;
  
  var score_sound,
      backboard,
      whoosh,
      fail,
      spawn;
  
  var moveInTween,
      fadeInTween,
      moveOutTween,
      fadeOutTween,
      emoji,
      emojiName;
  
  var collisionGroup;
  
  function create() {
  
    game.physics.startSystem(Phaser.Physics.P2JS);
  
    game.physics.p2.setImpactEvents(true);
  
    game.physics.p2.restitution = 0.63;
    game.physics.p2.gravity.y = 0;
  
    collisionGroup = game.physics.p2.createCollisionGroup();
  
    score_sound = game.add.audio('score');
    backboard = game.add.audio('backboard');
    backboard.volume = 0.5;
    whoosh = game.add.audio('whoosh');
    fail = game.add.audio('fail');
    fail.volume = 0.1;
    spawn = game.add.audio('spawn');
  
    game.stage.backgroundColor = "#ffffff";
  
    // high_score_text = game.add.text(450, 25, 'High Score\n' + high_score, { font: 'Arial', fontSize: '32px', fill: '#000', align: 'center' });
    current_score_text = game.add.text(187, 312, '', { font: 'Arial', fontSize: '40px', fill: '#000', align: 'center' }); // 300, 500
    current_best_text = game.add.text(143, 281, '', { font: 'Arial', fontSize: '20px', fill: '#000', align: 'center' });// 230, 450
    current_best_score_text = game.add.text(187, 312, '', { font: 'Arial', fontSize: '40px', fill: '#00e6e6', align: 'center' }); // 300, 500
  
    hoop = game.add.sprite(88, 62, 'hoop'); // 141, 100
    left_rim = game.add.sprite(150, 184, 'side rim'); // 241, 296
    right_rim = game.add.sprite(249, 184, 'side rim'); // 398, 296
  
    game.physics.p2.enable([ left_rim, right_rim], false);
  
    left_rim.body.setCircle(2.5);
    left_rim.body.static = true;
    left_rim.body.setCollisionGroup(collisionGroup);
    left_rim.body.collides([collisionGroup]);
  
    right_rim.body.setCircle(2.5);
    right_rim.body.static = true;
    right_rim.body.setCollisionGroup(collisionGroup);
    right_rim.body.collides([collisionGroup]);
  
    createBall();
  
    cursors = game.input.keyboard.createCursorKeys();
  
    game.input.onDown.add(click, this);
    game.input.onUp.add(release, this);
  
  
    var instructions = document.createElement("span");
    instructions.innerHTML = "Instructions: Quickly drag the ball to shoot the ball into the hoop!";
    instructions.innerHTML += `<br><button onclick="endGame()">End Game</button>`;
    document.getElementById("gameLocation").appendChild(instructions);
  }
  
  function update() {
  
    if (ball && ball.body.velocity.y > 0) {
      front_rim = game.add.sprite(148, 182, 'front rim');
      ball.body.collides([collisionGroup], hitRim, this);
    }
  
    if (ball && ball.body.velocity.y > 0 && ball.body.y > 188 && !ball.isBelowHoop) {
      ball.isBelowHoop = true;
      ball.body.collideWorldBounds = false;
      var rand = Math.floor(Math.random() * 5);
      if (ball.body.x > 151 && ball.body.x < 249) {
        emojiName = "win" + rand;
        current_score += 1;
        current_score_text.text = current_score;
        score_sound.play();
      } else {
        emojiName = "lose" + rand;
        fail.play();
        if (current_score > high_score) {
          high_score = current_score;
        // 	high_score_text.text = 'High Score\n' + high_score;
        }
        current_score = 0;
        current_score_text.text = '';
        current_best_text.text = 'Current Best';
        current_best_score_text.text = high_score;
        sessionStorage.setItem("basketballhighScore", high_score);
      }
      emoji = game.add.sprite(180, 100, emojiName);
      emoji.scale.setTo(0.25, 0.25);
      moveInTween = game.add.tween(emoji).from( { y: 150 }, 500, Phaser.Easing.Elastic.Out, true);
      fadeInTween = game.add.tween(emoji).from( { alpha: 0 }, 200, Phaser.Easing.Linear.None, true, 0, 0, false);
      moveInTween.onComplete.add(tweenOut, this);
    }
  
    if (ball && ball.body.y > 1200) {
      game.physics.p2.gravity.y = 0;
      ball.kill();
      createBall();
    }
  
  }
  
  function tweenOut() {
    moveOutTween = game.add.tween(emoji).to( { y: 50 }, 600, Phaser.Easing.Elastic.In, true);
    moveOutTween.onComplete.add(function() { emoji.kill(); }, this);
    setTimeout(function () {
      fadeOutTween = game.add.tween(emoji).to( { alpha: 0 }, 300, Phaser.Easing.Linear.None, true, 0, 0, false);
    }, 450);
  }
  
  function hitRim() {
  
    backboard.play();
  
  }
  
  function createBall() {
  
    var xpos;
    if (current_score === 0) {
      xpos = 200;
    } else {
      xpos = 60 + Math.random() * 280;
    }
    spawn.play();
    ball = game.add.sprite(xpos, 547, 'ball');
    game.add.tween(ball.scale).from({x : 0.7, y : 0.7}, 100, Phaser.Easing.Linear.None, true, 0, 0, false);
    game.physics.p2.enable(ball, false);
    ball.body.setCircle(60); // NOTE: Goes from 60 to 36
    ball.launched = false;
    ball.isBelowHoop = false;
  
  }
  
  var location_interval;
  var isDown = false;
  var start_location;
  var end_location;
  
  function click(pointer) {
  
    var bodies = game.physics.p2.hitTest(pointer.position, [ ball.body ]);
    if (bodies.length) {
      start_location = [pointer.x, pointer.y];
      isDown = true;
      location_interval = setInterval(function () {
        start_location = [pointer.x, pointer.y];
      }.bind(this), 200);
    }
  
  }
  
  function release(pointer) {
  
    if (isDown) {
      window.clearInterval(location_interval);
      isDown = false;
      end_location = [pointer.x, pointer.y];
  
      if (end_location[1] < start_location[1]) {
        var slope = [end_location[0] - start_location[0], end_location[1] - start_location[1]];
        var x_traj = -2300 * slope[0] / slope[1];
        launch(x_traj);
      }
    }
  
  }
  
  function launch(x_traj) {
  
    if (ball.launched === false) {
      ball.body.setCircle(36);
      ball.body.setCollisionGroup(collisionGroup);
      current_best_text.text = '';
      current_best_score_text.text = '';
      ball.launched = true;
      game.physics.p2.gravity.y = 3000;
      game.add.tween(ball.scale).to({x : 0.6, y : 0.6}, 500, Phaser.Easing.Linear.None, true, 0, 0, false);
      ball.body.velocity.x = x_traj;
      ball.body.velocity.y = -1750;
      ball.body.rotateRight(x_traj / 3);
      whoosh.play();
    }
  
  }

  }
  
  
  </script>
  <script src="script.js"></script>
  <script src="cartScript.js"></script>
</body>
</html>