<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <title>NoNego ðŸ’¸ðŸ’» - My Account</title>
</head>
<body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand fs-2 text-white" href="#">NoNego!</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto fs-4">
                    <li class="nav-item">
                        <a href="home.html" class="nav-link active text-white" aria-current="page">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="home.html#shop" class="nav-link text-white">Shop</a>
                    </li>
                    <li class="nav-item">
                        <a href="personalization.html" class="nav-link text-white">My Account</a>
                    </li>
                    <li class="nav-item">
                        <a href="myCart.html" class="nav-link text-white myCart">My Cart</a>
                    </li>
                </ul>
            </div>
          </div>
      </nav>
  </header>

  <section>
    <div class="row d-flex justify-content-center">
      <div class="col-5 title text-center mt-3 bg-dark">
          <h4 class="fs-1 text-light">Edit/Create Avatar</h4>
      </div>
    </div>
    <div class="row d-flex justify-content-center">
        <div id="AvtarPicSpace" class="col-3 bg-secondary">
          <img id="sampleAvatar"src="https://gutta.lv/wp-content/uploads/2015/10/test-img.jpg" class="card-img-top" id="prodImg2" alt="...">
        </div>


        <div class="col-5 text-center bg-primary">

          <button id="CreatAvtarButton" onclick="viewAvatarNav()">Click Here To Create Avatar</button>

          <!-- Edit/Create Avtar Nav Bar -->
          <nav id="CavtarNavBar"class="navbar navbar-expand-lg navbar-light bg-white">
            <div class="container-fluid">
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav fs-4">
                        <li class="nav-item">
                            <a href="#" onclick="avGender()" class="nav-link text-dark">Gender</a>
                        </li>
                        <li class="nav-item">
                          <a href="#" onclick="avExpression()" class="nav-link text-dark">Expressions</a>
                      </li>
                        <li class="nav-item">
                            <a href="#" onclick="avSkin()" class="nav-link text-dark">Skin</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" onclick="avHair()" class="nav-link text-dark">Hair</a>
                        </li>
                    </ul>
                </div>
              </div>
          </nav>

          <!-- Gender -->
          <section id="CavatarGender">
            <div class="form-check">
              <label class="form-check-label">
                <input type="radio" id="avatarGMale" class="form-check-input" name="optradio" value="male">Male
              </label>
            </div>
            <div class="form-check">
              <label class="form-check-label">
                <input type="radio" id="avatarGFemale" class="form-check-input" name="optradio" value="female">Female
              </label>
            </div>
        </section>


        <!-- Skin -->
        <section id="CavatarSkin">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Skin Colour
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </div>
          <button id="AvatardarkBrownSkin">Test Skin Color (Dark Brown)</button>
        </section>

        <!-- Hair -->
        <section id="CavatarHair">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Hair Type
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </div>
          <button>Test Hair Type</button>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Hair Colour
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </div>
          <button>Test Hair Color</button>
        </section>

        <!-- Expressions -->
        <section id="CavatarExpressions">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Expression Types
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Action</a>
              <a class="dropdown-item" href="#">Another action</a>
              <a class="dropdown-item" href="#">Something else here</a>
            </div>
          </div>
          <button id="AvatarAngry">Test Expression</button>
        </section>
        </div>

    </div>
    <div>
  </section>


  <section>

    <div class="row d-flex justify-content-center">
      <div class="col-5 title text-center mt-3 bg-dark">
          <h4 class="fs-1 text-light">Account Personalization</h4>
      </div>
    </div>
    <div class="row d-flex justify-content-center pb-5" style="overflow: scroll;">
        <div class="col-8 bg-secondary">

          <!-- Change Account Email and Pass -->
          <h2 class="pt-5"><i>Edit Account Details</i></h2>
          <form class="w-25">
            <div class="form-group">
              <label for="exampleInputEmail1">Email address</label>
              <input type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Password</label>
              <input type="password" class="form-control" id="inputPass" placeholder="Password">
            </div>
          </form>
          <button class="btn btn-primary"  onclick="makeChanges()">Make Changes</button>

          <!-- Dark mode switch -->
          <div class="form-check form-switch pt-5">
            <label class="form-check-label" for="flexSwitchCheckDefault">Dark Mode</label>
            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" />
          </div>

          <div class="text-center">
            <h1>Friend's List</h1>
            <div>

              <table class="table">
                <thead>
                  <tr>
                    <th>Avatar</th>
                    <th scope="col">Email</th>
                    <th scope="col">Membership</th>
                    <th scope="col">Points</th>
                  </tr>
                </thead>
                <tbody id="friendsTable">

                </tbody>
              </table>

              
            </div>
            <button id="afBtn" onclick="AddFriend()" type="button" class="btn btn-success">Add Friend</button>
            <button id="dfBtn" onclick="DeleteFriend()" type="button" class="btn btn-danger">Delete Friend</button>
          </div>

          <div id="addFriendTab">
            <div class="form-group" id="addFriendForm">
              <label for="addFriend">Email address</label>
              <input type="email" class="form-control w-50" id="addFriend" aria-describedby="emailHelp" placeholder="Enter email">
              <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
          </div>
          <div>
            <button id="submitAddFriends">Submit</button>
          </div>

          <div id="deleteFriendTab">
            <h3>Select Friend(s) You wish to Remove</h3>
          </div>
            <button id="cfmDelFriends" onclick="cfmDelFriends()">Confirm Delete</button>
        </div>

    </div>

  </section>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="script.js"></script>
  <script>

    $('#addFriendTab').hide();
    $('#submitAddFriends').hide();
    $('#deleteFriendTab').hide();
    $('#cfmDelFriends').hide();

    $('#CavtarNavBar').hide();
    
    $('#CavatarGender').hide();
    $('#CavatarSkin').hide();
    $('#CavatarHair').hide();
    $('#CavatarExpressions').hide();

    ///////////////////////////////////////
    function avGender()
    {
      $('#CavatarGender').show();
      $('#CavatarSkin').hide();
      $('#CavatarHair').hide();
      $('#CavatarExpressions').hide();
    }
    document.getElementById("avatarGMale").addEventListener("click", function()
    {
      createAvatar("1101");
    });
    document.getElementById("avatarGFemale").addEventListener("click", function()
    { 
      createAvatar("1102");
    });

    ///////////////////////////////////////
    function avExpression()
    {
      $('#CavatarExpressions').show();
      $('#CavatarGender').hide();
      $('#CavatarSkin').hide();
      $('#CavatarHair').hide();
    }

    document.getElementById("AvatarAngry").addEventListener("click", function()
    { 
      let aCode = localStorage.getItem("AvatarKey");
      EditAvatarAsset("3", aCode);
    });

    ///////////////////////////////////////
    function avSkin()
    {
      $('#CavatarSkin').show();
      $('#CavatarHair').hide();
      $('#CavatarExpressions').hide();
      $('#CavatarGender').hide();
    }
    document.getElementById("AvatardarkBrownSkin").addEventListener("click", function()
    { 
      let aCode = localStorage.getItem("AvatarKey");
      EditAvatarSkin("8D5524", aCode);
    });
    ///////////////////////////////////////

    function avHair()
    {
      $('#CavatarHair').show();
      $('#CavatarGender').hide();
      $('#CavatarSkin').hide();
      $('#CavatarExpressions').hide();
    }

  // DISPLAYING FRIENDS LIST
var friendsList = localStorage.getItem("friendsList").split(",");

var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment",
    "method": "GET",
    "headers": {
      "content-type": "application/json",
      "x-apikey": "5ffd5eb61346a1524ff12901",
      "cache-control": "no-cache"
    }
  }

  $.ajax(settings).done(function (response) {

    console.log(friendsList);

    for (var i = 0; i < friendsList.length; i++)
    {
      for (var x = 0; x < response.length; x++)
      {
        if (friendsList[i] == response[x].useremail)
        {
          document.getElementById("friendsTable").innerHTML += 
          `<tr>
              <th scope="row">${response[x].userAvatar}</th>
              <td>${response[x].useremail}</td>
              <td>${response[x].userMembership}</td>
              <td>${response[x].userPoints}</td>
          </tr>`
        }
      }
    }

  });

function AddFriend()
{
  $('#addFriendTab').show();
  $('#submitAddFriends').show();
  $('#afBtn').hide();
  $('#dfBtn').hide();
}

function DeleteFriend()
{

  $('#deleteFriendTab').show();
  $('#afBtn').hide();
  $('#dfBtn').hide();

  for (var i = 0; i<friendsList.length; i++)
  {
    document.getElementById("deleteFriendTab").innerHTML += `
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="userFriends" value="${friendsList[i]}" id="flexCheckDefault">
      <label class="form-check-label" for="flexCheckDefault">
        ${friendsList[i]}
      </label>
    </div>
    `;
  }

  $('#cfmDelFriends').show();

}

function cfmDelFriends()
{

  const checkboxes = document.querySelectorAll('input[name="userFriends"]:checked');

  let checkedFriends = [];
  checkboxes.forEach((checkbox) => {
    checkedFriends.push(checkbox.value);
  });

  for (i = 0; i < checkedFriends.length; i++)
  {
    removeElement(friendsList, checkedFriends[i]);
  }

  function removeElement(array, elem) {
    var index = array.indexOf(elem);
    if (index > -1) {
        array.splice(index, 1);
    }
  }

  var newFriends = friendsList.toString();
  localStorage.setItem("friendsList", newFriends);
  UpdateFriendsList(newFriends);

}

var submitNewFriends = document.getElementById("submitAddFriends");

submitNewFriends.addEventListener("click", function()
{

  var x = document.getElementById("addFriend");
  console.log(x.value)
  var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment",
    "method": "GET",
    "headers": {
      "content-type": "application/json",
      "x-apikey": "5ffd5eb61346a1524ff12901",
      "cache-control": "no-cache"
    }
  }

  $.ajax(settings).done(function (response) {

    var result = CheckUserExists(response, x.value);
    console.log(result);
    if (result == 2 || x.value == "")
    {
      alert("Account does not exist");
    }
    else if (result == 1)
    {
      var y = CheckFriendInList(friendsList, x.value);

      if (y == 1)
      {
        alert("friend already exists in your current list");
      }
      else if (y == 2)
      {
        friendsList.push(x.value);
        newFriends = friendsList.toString();
        localStorage.setItem("friendsList", newFriends);
        UpdateFriendsList(newFriends);
      }

    }

  });

});

function CheckUserExists(response, inputEmail)
{
  for (let i = 0; i < response.length; i++)
  {
    if (response[i].useremail === inputEmail)
    {
      return 1;
    }
  }
  return 2;
}

function CheckFriendInList(friendsList, inputEmail)
{
  for (z = 0; z < friendsList.length; z++)
  {
    if (friendsList[z] === inputEmail)
    {
      return 1;
    }
  }
  return 2;
}

function UpdateFriendsList(newFriends)
{
console.log(newFriends);

    var jsondata = {
        "friendsList": newFriends,
        "userAvatar": localStorage.getItem("userAvatar"),
        "userMembership": localStorage.getItem("userMembership"),
        "userPoints": localStorage.getItem("userPoints"),
        "useremail": localStorage.getItem("userName"),
        "userpass": localStorage.getItem("userPass"),
        "userTokens": localStorage.getItem("userTokens"),
    };
    var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment/" + localStorage.getItem("userID"),
    "method": "PUT",
    "headers": {
      "content-type": "application/json",
      "x-apikey": "5ffd5eb61346a1524ff12901",
      "cache-control": "no-cache"
        },
        "processData": false,
        "data": JSON.stringify(jsondata)
    }

  $.ajax(settings).done(function (response) {
    console.log(response);

    $('#deleteFriendTab').hide();
    $('#cfmDelFriends').hide();
    $('#addFriendForm').hide();
    $('#submitAddFriends').hide();
    alert("Refresh Page once again to get updated friendsList");
  });
}

function makeChanges()
{
    var changeEmail = document.getElementById("inputEmail").value;
    var changePass = document.getElementById("inputPass").value;

    var jsondata = {
        "friendsList": localStorage.getItem("friendsList"),
        "userAvatar": localStorage.getItem("userAvatar"),
        "userMembership": localStorage.getItem("userMembership"),
        "userPoints": localStorage.getItem("userPoints"),
        "useremail": changeEmail,
        "userpass": changePass,
        "userTokens": localStorage.getItem("userTokens"),
        };
        var settings = {
        "async": true,
        "crossDomain": true,
        "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment/" + localStorage.getItem("userID"),
        "method": "PUT",
        "headers": {
        "content-type": "application/json",
        "x-apikey": "5ffd5eb61346a1524ff12901",
        "cache-control": "no-cache"
            },
            "processData": false,
            "data": JSON.stringify(jsondata)
        }

    $.ajax(settings).done(function (response) {
        console.log(response);
        refreshData();
        alert("Refresh Page once again to get updated Account Details");
    });

}


  </script>
</body>
</html>