<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link rel="stylesheet" href="./css/index.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>NoNego ðŸ’¸ðŸ’»</title>
</head>
<body>

  <div class="loadingLottie" style="margin-top: 55px;">
    <lottie-player src="https://assets4.lottiefiles.com/packages/lf20_r63rTC.json"  background="transparent"  speed="1"  style="width: 600px; height: 600px;"    autoplay></lottie-player>
  </div>
  <div class="wrongPassLottie" style="margin-top: 75px;">
    <lottie-player src="https://assets1.lottiefiles.com/packages/lf20_h3Bz5a.json"  background="transparent"  speed="1"  style="width: 500px; height: 500px;"  loop  autoplay></lottie-player>
  </div>
  <div class="successLottie" style="margin-top: 75px; justify-content: center;">
    <lottie-player src="https://assets7.lottiefiles.com/packages/lf20_tAtUrg.json"  background="transparent"  speed="1"  style="width: 500px; height: 500px;"  loop  autoplay></lottie-player>
  </div>

  <section id="signIn">
    <div class='container mx-auto mt-5 col-md-10 mt-100'>
      <div class="row" style="justify-content: center">
          <div class="card col-md-3 mt-100" style="border: 8px solid grey;">
              <div class="card-content">

                  <div class="card-body p-0">
                      <div class="profile bg-light shadow" style="border-radius: 25px;">
                        <h2>Sign<br>In</h2>
                      </div>
                      <div class="card-subtitle">
                        <form>
                          <div class="form-group" style="text-align: left;">
                            <label for="inputEmail">Email address</label>
                            <input type="email" class="form-control" id="inputEmail" aria-label="emailHelp" placeholder="Enter email">
                            <small class="form-text text-muted emailHelp">We'll never share your email with anyone else.</small>
                          </div>
                          <div class="form-group" style="text-align: left;">
                            <label for="inputPass">Password</label>
                            <input type="password" class="form-control" id="inputPass" placeholder="Password">
                          </div>
                        </form>
                        <button class="btn" id="LogInButton">Log In</button>
                        <button class="btn" onclick="signUp()">Click Here To Sign Up</button>
                      </div>
                      </div>
                  </div>

              </div>
          </div>
      </div>
  </section>

  <section class="signUp">

    <div class='container mx-auto mt-5 col-md-10 mt-100'>
      <div class="row" style="justify-content: center">
          <div class="card col-md-3 mt-100" style="border: 8px solid grey;">
              <div class="card-content" >

                  <div class="card-body p-0">
                      <div class="profile bg-light shadow" style="border-radius: 25px;">
                        <h2>Sign<br>Up</h2>
                      </div>
                      <div class="card-subtitle">

                        <form>
                          <div class="form-group">
                            <label for="createEmail">Email address</label>
                            <input type="email" class="form-control" id="createEmail" aria-label="emailHelp" placeholder="Enter email">
                            <small class="form-text text-muted emailHelp">We'll never share your email with anyone else.</small>
                          </div>
                          <div class="form-group">
                            <label for="createPass">Password</label>
                            <input type="password" class="form-control" id="createPass" placeholder="Password">
                          </div>
                          <div class="form-group">
                            <label for="createPassCfm">Confirm Password</label>
                            <input type="password" class="form-control" id="createPassCfm" placeholder="Confirm Password">
                          </div>
                        </form>
                        <button class="btn btn-primary" id="SignUpButton">Sign Up</button>

                      </div>
                  </div>

              </div>
          </div>
      </div>
    </div>

  </section>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
<script src="./script/script.js"></script>
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script>
  $(".loadingLottie").hide();
  $(".signUp").hide();
  $(".wrongPassLottie").hide();
  $('.successLottie').hide();
  localStorage.clear();

  var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment",
    "method": "GET",
    "headers": {
      "content-type": "application/json",
      "x-apikey": "5ffd5eb61346a1524ff12901",
      "cache-control": "no-cache"
    }
  };

  $.ajax(settings).done(function (response) {
    console.log(response);

    document.getElementById("LogInButton").addEventListener("click", function()
    {

      var inputEmail = document.getElementById("inputEmail").value;
      var inputPass = document.getElementById("inputPass").value;

      var i = CheckUserExists(inputEmail, inputPass);

      if (i === 1)
      {

        $('#signIn').hide();
        $('.loadingLottie').show();

        setTimeout(loadScreen, 3000);
        
        function loadScreen(){
          redirectHomePage();
        }

      }
      else if (i === 2)
      {

        $('#signIn').hide();
        $('.wrongPassLottie').show();

        setTimeout(loadScreen, 3000);
        
        function loadScreen(){
          $('#signIn').show();
          $('.wrongPassLottie').hide();
          alert("Wrong Password");
        }

      }
      else
      {

        $('#signIn').hide();
        $('.wrongPassLottie').show();

        setTimeout(loadScreen, 3000);
        
        function loadScreen(){
          $('#signIn').show();
          $('.wrongPassLottie').hide();
          alert("ACCOUNT DOES NOT EXIST");
        }

      }

    });

    function CheckUserExists(email, password) {

      for (i=0; i < response.length; i++)
      {
        if (inputEmail.value == response[i].useremail && inputPass.value == response[i].userpass )
        {
          localStorage.setItem("userName", response[i].useremail);
          localStorage.setItem("userID", response[i]._id);
          localStorage.setItem("userMembership", response[i].userMembership);
          localStorage.setItem("userPoints", response[i].userPoints);
          localStorage.setItem("userAvatar", response[i].userAvatar);
          localStorage.setItem("userTokens", response[i].userTokens);
          localStorage.setItem("friendsList", response[i].friendsList);
          localStorage.setItem("userPass", response[i].userpass);
          return 1;
        }
        else if (inputEmail.value == response[i].useremail && inputPass.value != response[i].userpass)
        {
          return 2;
        }
      }
    }

    function redirectHomePage() {
      window.location.href = 'home.html';
    }
  });

///////////////////////////////////////////////////
/// SIGINING UP
///////////////////////////////////////////////////

  function signUp()
  {

    $(".signUp").show();

  }


  $("#SignUpButton").on("click", function (e) {
    e.preventDefault();

    let email = $("#createEmail").val();
    let pass = $("#createPass").val();

    var settings = {
      "async": true,
      "crossDomain": true,
      "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment",
      "method": "GET",
      "headers": {
        "content-type": "application/json",
        "x-apikey": "5ffd5eb61346a1524ff12901",
        "cache-control": "no-cache"
      }
    };

    $.ajax(settings).done(function (response) {
      console.log(response);
      var result = CheckUserExists(response, email);

    if (result == 1)
    {

      $('.signUp').hide();
      $('#signIn').hide();
      $('.wrongPassLottie').show();

      setTimeout(loadScreen, 3000);
        
      function loadScreen(){
        $('#signIn').show();
        $('.wrongPassLottie').hide();
        $('.signUp').hide();
        alert("This Account Already Exists");
      }

    }
    else if (result == 2)
    {

      let jsondata = {
      "useremail": email,
      "userpass": pass,
      "userAvatar": "",
      "userMembership": "Delta",
      "userPoints": 0,
      "friendsList": "",
      "userTokens": 1,
      };


      let settings = {
        "async": true,
        "crossDomain": true,
        "url": "https://studentcrud-a7cf.restdb.io/rest/nonegoidassignment",
        "method": "POST",
        "headers": {
          "content-type": "application/json",
          "x-apikey": '5ffd5eb61346a1524ff12901',
          "cache-control": "no-cache"
        },
          "processData": false,
          "data": JSON.stringify(jsondata),
          "beforeSend": function(){
            $("#SignUpButton").prop("disabled", true);
            
          }
        };

        $.ajax(settings).done(function (response) {
          console.log(response);

          $('.signUp').hide();
          $('#signIn').hide();
          $('.successLottie').show();

          setTimeout(loadScreen, 3000);
              
          function loadScreen(){
            $('#signIn').show();
            $('.successLottie').hide();
            $('.signUp').hide();
          }

        });
      
    }

    });
    
  }); 




</script>


</body>
</html>